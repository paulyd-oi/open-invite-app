HANDOFF PACKET â€” DEV-ONLY TEXT RENDER CRASH DETECTOR
=====================================================
Date: 2025-01-30
Branch: main
Commit: 9c51a12
Repo: github.com/paulyd-oi/open-invite-app.git

SUMMARY
-------
Added DEV-only runtime detector for "Text strings must be rendered within
a <Text> component" crash that occurs in TestFlight. Exhaustive static
analysis did not find the culprit, so instrumentation was added to capture
stack traces when the crash occurs at runtime.

PROBLEM
-------
TestFlight users experiencing crash with message:
  "Text strings must be rendered within a <Text> component"

This React Native error occurs when raw strings/numbers are rendered 
directly inside View components instead of Text components.

INVESTIGATION PERFORMED
-----------------------
Static needle search across all .tsx files for common patterns:

1. `&& "string"` - Found 3 matches, all properly inside <Text>
2. `return "string"` - Helper functions only, not JSX
3. View + children patterns - Wrapper components passing React nodes
4. Ternary `? "string"` - All properly wrapped in <Text>
5. Template literals `{...}` - All properly wrapped
6. Number rendering `{0}` or `{count}` - None found raw
7. Function call results in Views - All return valid ReactNode

Files manually inspected:
- event-request/[id].tsx
- import-calendar.tsx  
- settings.tsx
- notification-settings.tsx
- activity.tsx
- CircleCard.tsx
- EmptyState.tsx
- Toast.tsx

NO CULPRIT FOUND via static analysis.

SOLUTION IMPLEMENTED
--------------------
DEV-only runtime detector to capture crash location on reproduction.

FILES CHANGED
-------------
1. src/app/_layout.tsx (lines 52-62)
   - Added console.error interceptor (DEV only)
   - Detects "Text strings must be rendered" message
   - Logs stack trace when triggered
   
2. src/components/ErrorBoundary.tsx
   - Enhanced componentDidCatch
   - Checks for Text render crash message
   - Logs component stack + JS stack

KEY CODE
--------
_layout.tsx:
  if (__DEV__) {
    const originalConsoleError = console.error;
    console.error = (...args) => {
      const message = args[0]?.toString?.() ?? '';
      if (message.includes('Text strings must be rendered')) {
        console.warn('ðŸ”´ TEXT RENDER CRASH DETECTED');
        console.warn('Stack:', new Error().stack);
      }
      originalConsoleError.apply(console, args);
    };
  }

VERIFICATION
------------
- npm run typecheck: PASSED
- bash scripts/ai/verify_frontend.sh: PASS

NEXT STEPS FOR FUTURE AGENT
---------------------------
1. User must REPRODUCE the crash in DEV mode (simulator/Expo Go)
2. When crash occurs, look for console output:
   ðŸ”´ TEXT RENDER CRASH DETECTED
   Stack: [full stack trace showing offending component]
3. Stack trace will reveal exact file + line of bad JSX
4. Fix the identified code (wrap string/number in <Text>)
5. Remove DEV-only detector after fix confirmed

POSSIBLE CRASH SOURCES NOT YET EXPLORED
---------------------------------------
- Third-party library components
- Race condition in async data loading
- Platform-specific code paths (iOS-only)
- Edge case in navigation state

WHY STATIC SEARCH FAILED
------------------------
The crash may be:
1. In a code path not exercised during static analysis
2. A race condition where undefined/null becomes string
3. In library code we don't control
4. Platform-specific rendering issue

IMPORTANT
---------
DO NOT GUESS at the fix. The detector must capture the exact location.
The crash is real (TestFlight reports) but source is NOT YET IDENTIFIED.
