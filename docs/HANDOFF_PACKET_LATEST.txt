========================================
HANDOFF PACKET - Remove Legacy "Add to Groups" Modals
========================================
Date: 2026-01-29
Branch: main
Author: GitHub Copilot (Claude Opus 4.5)

========================================
SUMMARY
========================================
Removed legacy "Add to Groups" modals from friend add flows pre-launch.
These modals showed outdated "Groups" concept (not Circles) and caused
confusion. After accepting a friend request, users now see a clean
success toast and smooth redirect instead of the legacy modal.

- Removed modal state variables, triggers, mutations, and JSX
- Added [LEGACY_ADD_TO_GROUPS_REMOVED] comments for future reference
- Added DEV-only console log at trigger points
- friends.tsx: Shows toast "Friend added!" after accepting request
- user/[id].tsx: Redirects to friend profile after accepting request

========================================
ROOT CAUSE
========================================
1. friends.tsx:
   - acceptRequestMutation.onSuccess triggered setShowAddToGroupsModal(true)
   - Modal JSX rendered when showAddToGroupsModal was true
   
2. user/[id].tsx:
   - acceptRequestMutation.onSuccess triggered setShowAddToGroupsModal(true)
   - Modal JSX rendered when showAddToGroupsModal was true

========================================
FILES CHANGED
========================================
src/app/friends.tsx
  - Removed state: showAddToGroupsModal, newlyAcceptedFriend, selectedGroupIds
  - Removed trigger in acceptRequestMutation.onSuccess
  - Removed addFriendToGroupsMutation
  - Removed modal JSX (~160 lines)
  - Added success toast: "Friend added!" after accepting request
  - Added [LEGACY_ADD_TO_GROUPS_REMOVED] comments

src/app/user/[id].tsx
  - Removed state: showAddToGroupsModal, newlyAcceptedFriend, selectedGroupIds
  - Removed groups query (only used for modal)
  - Removed trigger in acceptRequestMutation.onSuccess
  - Removed addFriendToGroupsMutation
  - Removed modal JSX (~175 lines)
  - Clean redirect to friend profile after accepting request
  - Removed unused imports: Modal, GetGroupsResponse
  - Added [LEGACY_ADD_TO_GROUPS_REMOVED] comments

========================================
KEY DIFFS
========================================
friends.tsx (acceptRequestMutation.onSuccess):
- if (data.friendshipId && data.friend) {
-   setNewlyAcceptedFriend({ ... });
-   setShowAddToGroupsModal(true);
- }
+ if (__DEV__) console.log('[LEGACY_ADD_TO_GROUPS_REMOVED] Would have shown add-to-groups modal');
+ safeToast.success("Friend added!", data.friend?.name ? `${data.friend.name} is now your friend` : "You're now friends");

user/[id].tsx (acceptRequestMutation.onSuccess):
- if (groups.length > 0 && user) {
-   setShowAddToGroupsModal(true);
- } else {
-   router.replace(`/friend/${responseData.friendshipId}`);
- }
+ if (__DEV__) console.log('[LEGACY_ADD_TO_GROUPS_REMOVED] Would have shown add-to-groups modal');
+ if (responseData.friendshipId) {
+   router.replace(`/friend/${responseData.friendshipId}`);
+ }

========================================
RUNTIME STATUS
========================================
Verification command:
  bash scripts/ai/verify_frontend.sh

Result: PASS
  - TypeScript: No errors
  - Invariants: All passed
  - No uppercase Cookie headers
  - No !!session gating

========================================
MANUAL REPRO
========================================
1. Open app, go to Friends tab
2. Search for a user or receive a friend request
3. Accept friend request
4. EXPECTED: See success toast "Friend added!" (friends.tsx)
   OR redirect to friend profile (user/[id].tsx)
5. EXPECTED: NO "Add to Groups" modal appears anywhere
6. DEV console should show: [LEGACY_ADD_TO_GROUPS_REMOVED]

========================================
ASSUMPTIONS / UNCERTAINTIES
========================================
- Group filter feature in friends.tsx is preserved (uses same groups query)
- Circles feature is separate and untouched
- No backend changes needed (modals were frontend-only)
- Second order social nudge still works (separate flow)

========================================
END HANDOFF
