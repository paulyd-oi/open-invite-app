HANDOFF PACKET -- Circle Photo Avatar Caching + No-Flicker Placeholder
Date: 2026-02-09

SUMMARY
- Created shared CirclePhotoEmoji component that always renders emoji as the base layer and overlays the photo with a 200ms opacity fade-in on load.
- Replaced all 5 circle avatar render sites (4 files) with the new component.
- On load failure: emoji stays visible, DEV-only log with [CIRCLE_PHOTO_LOAD_FAIL] tag.
- No new dependencies. Uses react-native Animated (already available) for the fade.
- Removed unused Image imports from create.tsx and event/edit/[id].tsx.
- Zero layout shift: container dimensions unchanged, overflow:hidden preserved at every site.

ROOT CAUSE
Circle photo avatars used a simple ternary (photo ? Image : emoji). On slow networks or first load, the Image takes time to fetch, showing a blank container (no emoji, no photo) until loaded. No error handling existed for broken URLs.

FIX
New CirclePhotoEmoji component (src/components/CirclePhotoEmoji.tsx):
- Always renders emoji Text as the base layer (visible immediately).
- If photoUrl is present and not errored, overlays an Animated.Image with StyleSheet.absoluteFill.
- Opacity starts at 0, transitions to 1 with Animated.timing (200ms) on onLoad callback.
- On onError: sets errored state (hides Image), logs [CIRCLE_PHOTO_LOAD_FAIL] in DEV.
- Parent containers already have overflow:hidden + fixed dimensions, so transition is seamless.

FILES CHANGED
src/components/CirclePhotoEmoji.tsx (NEW) -- shared component
src/components/CircleCard.tsx -- import + use CirclePhotoEmoji at avatar site
src/app/circle/[id].tsx -- import + use CirclePhotoEmoji at header + settings block (2 sites)
src/app/create.tsx -- import + use CirclePhotoEmoji at circle picker, remove unused Image import
src/app/event/edit/[id].tsx -- import + use CirclePhotoEmoji at circle picker, remove unused Image import

AVATAR SITES COVERED (5 total)
1. src/components/CircleCard.tsx line 320 -- circles list card (56x56)
2. src/app/circle/[id].tsx line 2316 -- circle detail header (40x40)
3. src/app/circle/[id].tsx line 3704 -- circle settings info block (56x56)
4. src/app/create.tsx line 1244 -- event creation circle picker (32x32)
5. src/app/event/edit/[id].tsx line 480 -- event edit circle picker (32x32)

VERIFICATION
npm run typecheck -- PASS (0 errors)
bash scripts/ai/verify_frontend.sh -- PASS

SWEEP PROOFS
All circle avatar sites using CirclePhotoEmoji (loaded-state logic):
  src/components/CircleCard.tsx:320
  src/app/circle/[id].tsx:2316
  src/app/circle/[id].tsx:3704
  src/app/create.tsx:1244
  src/app/event/edit/[id].tsx:480
  Count: 5 sites across 4 files

No remaining bare photoUrl Image rendering:
  rg circle.photoUrl.*Image src/ -- (none found)

package.json unchanged:
  git diff HEAD -- package.json -- (empty)

git show --stat HEAD
commit 45730608337e94d88bc82013b15d5cf3d54e984e (HEAD -> main, origin/main, origin/HEAD)
Author: paulyd-oi <pauljdal@gmail.com>
Date:   Mon Feb 9 21:39:46 2026 -0800

    polish(circles): no-flicker photo avatar with emoji placeholder + fade-in

 src/app/circle/[id].tsx             | 13 +++---------
 src/app/create.tsx                  |  8 ++------
 src/app/event/edit/[id].tsx         |  8 ++------
 src/components/CircleCard.tsx       |  7 ++-----
 src/components/CirclePhotoEmoji.tsx | 60 ++++++++++++++++++++++++++++++++++++++++++++++++++++++
 5 files changed, 69 insertions(+), 27 deletions(-)

git show --name-only HEAD
commit 45730608337e94d88bc82013b15d5cf3d54e984e (HEAD -> main, origin/main, origin/HEAD)
Author: paulyd-oi <pauljdal@gmail.com>
Date:   Mon Feb 9 21:39:46 2026 -0800

    polish(circles): no-flicker photo avatar with emoji placeholder + fade-in

src/app/circle/[id].tsx
src/app/create.tsx
src/app/event/edit/[id].tsx
src/components/CircleCard.tsx
src/components/CirclePhotoEmoji.tsx
