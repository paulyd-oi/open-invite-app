HANDOFF PACKET - Signup Cookie Session Fix
================================================================================

SUMMARY
-------
- Fixed email signup not establishing Better Auth cookie session
- welcome.tsx was using raw $fetch to /api/auth/sign-up/email
- This bypassed authClient.signUp.email() which has cookie establishment logic
- Now uses proper authClient methods + verifies session before proceeding

PRECHECK
--------
pwd: /Users/paulsmbp/Documents/GitHub/open-invite-app
branch: main
remote: https://github.com/paulyd-oi/open-invite-app.git
status: modified files pending commit

ROOT CAUSE
----------
welcome.tsx handleEmailAuth() used raw authClient.$fetch('/api/auth/sign-up/email')
which does NOT call:
- captureAndStoreCookie()
- refreshExplicitCookie() 
- verifySessionAfterAuth()

The authClient.signUp.email() method already has all this logic built in.
Signup returned 200 but cookie was never stored in SecureStore, so next
/api/auth/session returned 401 and onboarding bounced to login.

CHANGES
-------
Files changed:
- src/app/welcome.tsx - Use authClient.signUp/signIn.email() instead of raw $fetch
- docs/STATE_OF_THE_APP.md - Updated with signup fix status
- docs/FINDINGS_LOG.md - Added finding about signup bypassing cookie establishment

Key diffs in welcome.tsx handleEmailAuth():
BEFORE:
  result = await authClient.$fetch('/api/auth/sign-up/email', {...})
  result = await authClient.$fetch('/api/auth/sign-in/email', {...})
  // No cookie establishment, just token storage
  setCurrentSlide(3)

AFTER:
  result = await authClient.signUp.email({...})
  result = await authClient.signIn.email({...})
  // Verify session established before proceeding
  const session = await getSessionCached()
  if (!session?.user?.id) {
    setErrorBanner("Session could not be established. Please try again.");
    return;
  }
  setCurrentSlide(3)

TESTING
-------
Commands run:
- npm run typecheck: PASSED
- scripts/ai/verify_frontend.sh: PENDING

VERIFICATION
------------
Manual checks needed:
A) Fresh install / clear app storage
B) Create new account via email signup
   - Confirm logs show refreshExplicitCookie success
   - Confirm /api/auth/session returns 200 immediately after signup
   - Confirm onboarding continues (no bounce to login)
C) Logout then login existing account still works
D) Switch accounts: logout â†’ login different account works

STATE UPDATE
------------
STATE_OF_THE_APP updated: YES
FINDINGS_LOG updated: YES
INVARIANTS changed: NO

GIT
---
Commit: PENDING
Pushed: PENDING
