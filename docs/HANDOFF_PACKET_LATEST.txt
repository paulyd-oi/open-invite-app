HANDOFF PACKET -- Event Photo Lite
Date: 2026-02-09

SUMMARY
- Added Event Photo Lite: hero photo display on Event Details, host-only nudge to add photo, client-side compression + Cloudinary upload, photo thumbnail in social feed.
- Backend already has PUT /api/events/:id/photo endpoint with privacy enforcement (busy/private events get null photo fields).
- Frontend: added eventPhotoUrl + eventPhotoPublicId to eventSchema, uploadEventPhoto utility (4:3, 1280px wide, JPEG 0.75, hard cap <1.5MB), hero + nudge + upload sheet on Event Details, photo thumbnail on social feed EventCard.
- No changes to Create or Edit event screens (strict non-goal).
- No new dependencies.
- Nudge dismiss persisted via AsyncStorage per event ID.

ROOT CAUSE
Events had no cover photo capability. The backend already supported eventPhotoUrl/eventPhotoPublicId fields with privacy enforcement, but the frontend schema and UI had no support for displaying or uploading event photos.

FIX
1. shared/contracts.ts: Added eventPhotoUrl and eventPhotoPublicId to eventSchema (nullable, optional).
2. src/lib/imageUpload.ts: Added uploadEventPhoto() -- resize to 1280x960 (4:3), JPEG quality 0.75, progressive quality reduction loop if >= 1.5MB, upload to Cloudinary folder openinvite/event_photos, DEV log [EVENT_PHOTO_COMPRESS].
3. src/app/event/[id].tsx:
   - Hero photo: 4:3 aspect ratio Image rendered above the header card when eventPhotoUrl exists and event is not busy. Host gets an edit (pencil) overlay button.
   - Host nudge: dashed border placeholder with Camera icon, "Add a photo (optional)" text, "Add photo" button (themeColor bg), "Not now" dismiss. Shown only when: viewer is host AND no photo AND not busy AND not dismissed.
   - Dismiss persistence: AsyncStorage key dismissedEventPhotoNudge_{eventId}.
   - Upload bottom sheet: Upload/Replace photo (ImagePicker 4:3 crop -> uploadEventPhoto -> PUT /api/events/:id/photo), Remove photo (PUT with remove:true), Cancel.
   - Privacy guard: Hero and nudge both gated on !event.isBusy.
4. src/app/social.tsx: EventCard renders photo thumbnail (4:3 aspect, rounded-xl, overflow-hidden) above the emoji+title row when displayEvent.eventPhotoUrl exists.

FILES CHANGED
shared/contracts.ts -- +3 lines (eventPhotoUrl, eventPhotoPublicId on eventSchema)
src/lib/imageUpload.ts -- +67 lines (EVENT_PHOTO_FOLDER constant + uploadEventPhoto function)
src/app/event/[id].tsx -- +125 lines (imports, state, hero photo, nudge, upload sheet)
src/app/social.tsx -- +7 lines (photo thumbnail in EventCard)
docs/STATE_OF_THE_APP.md -- +1 line

VERIFICATION
npm run typecheck -- PASS (0 errors)
bash scripts/ai/verify_frontend.sh -- PASS

SWEEP PROOFS

Create/Edit screens contain NO new photo logic:
  rg eventPhotoUrl|uploadEventPhoto|showPhotoSheet|EVENT_PHOTO src/app/create.tsx src/app/event/edit/[id].tsx -- (none found)

Cloudinary event_photos folder string appears once:
  src/lib/imageUpload.ts:286 -- EVENT_PHOTO_FOLDER = "openinvite/event_photos"

package.json unchanged:
  git diff HEAD -- package.json -- (empty)

git show --stat HEAD
commit ab2bd00787f85b5a74beb0a515ba51ec07e64f6c (HEAD -> main, origin/main, origin/HEAD)

    feat(events): Event Photo Lite -- hero photo, host nudge, compression, social feed render

 docs/STATE_OF_THE_APP.md |   1 +
 shared/contracts.ts      |   3 ++
 src/app/event/[id].tsx   | 125 +++++++++++++++++++++++++++++++++++++++++++++
 src/app/social.tsx       |   7 ++++
 src/lib/imageUpload.ts   |  67 ++++++++++++++++++++++++++++++++++
 5 files changed, 202 insertions(+), 1 deletion(-)
