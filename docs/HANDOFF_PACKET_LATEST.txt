HANDOFF PACKET — PERFORMANCE SWEEP: FRIENDS, SOCIAL, CALENDAR
====================================================================
Date: 2025-02-01
Branch: main
Repo: github.com/paulyd-oi/open-invite-app.git

SUMMARY
-------
Performance optimization pass to make Friends tab (primary) smooth with 50+ 
friends, and reduce perceived "network lag" across Friends + Social + Calendar 
by preventing unnecessary refetch, blanking, and render churn.

PROBLEM
-------
1. Query overfetch on every navigation/focus (staleTime=0 by default)
2. Animation overhead on every FriendCard row
3. Inline callbacks causing unnecessary re-renders
4. No memoization on expensive components (MiniCalendar, FriendCard)

SOLUTION — QUERY TUNING
-----------------------

friends.tsx:
- ["friends"]: staleTime=5min, gcTime=10min, refetchOnMount=false, 
               refetchOnWindowFocus=false, placeholderData
- ["friendRequests"]: staleTime=1min, refetchOnMount=false, refetchOnWindowFocus=false
- ["circles"]: staleTime=5min, refetchOnMount=false, refetchOnWindowFocus=false
- ["pinnedFriendships"]: staleTime=5min, refetchOnMount=false, refetchOnWindowFocus=false

social.tsx:
- ["events", "feed"]: staleTime=30s, refetchInterval=60s (was 30s), placeholderData
- ["events", "mine"]: staleTime=1min, placeholderData
- ["events", "attending"]: staleTime=1min, placeholderData
- ["friends"]: staleTime=5min

calendar.tsx:
- ["friends"]: staleTime=5min, refetchOnMount=false, refetchOnWindowFocus=false

SOLUTION — COMPONENT MEMOIZATION
--------------------------------

1. MiniCalendar: Wrapped in React.memo (prevents re-render when parent updates)
2. FriendCard: 
   - Wrapped in React.memo
   - useCallback for handlePress + handleLongPress (stable references)
   - Conditional animation: only first 5 items get FadeInDown (reduces jank)
3. FriendListItem: Already React.memo (verified, no change needed)

DEV INSTRUMENTATION
-------------------
- console.time("[PERF] Friends query") / console.timeEnd() around friends fetch
- FriendCard.__renderCount tracking in DEV builds for measuring render churn

FILES CHANGED
-------------
1. src/app/friends.tsx (MODIFIED)
   - MiniCalendar: React.memo wrapper
   - FriendCard: React.memo + useCallback + conditional animation
   - Query tuning for friends, friendRequests, circles, pinnedFriendships

2. src/app/social.tsx (MODIFIED)
   - Query tuning for feed, mine, attending, friends
   - refetchInterval reduced from 30s to 60s

3. src/app/calendar.tsx (MODIFIED)
   - Query tuning for friends

4. docs/FINDINGS_LOG.md (MODIFIED)
   - Added Performance Sweep entry

VERIFICATION
------------
npm run typecheck                    PASS
./scripts/ai/verify_frontend.sh      PASS

REGRESSION RISK
---------------
LOW - All changes are performance optimizations that don't alter business logic.
- staleTime/gcTime only affects caching duration, not correctness
- React.memo only prevents unnecessary re-renders, not correct renders
- Conditional animation only affects visual polish, not functionality

MANUAL TESTING RECOMMENDED
--------------------------
1. Add 20+ friends, navigate to Friends tab repeatedly
2. Verify list doesn't blank/flash on tab switch
3. Verify pinning still works
4. Verify expand/collapse mini-calendar still works
5. Pull-to-refresh still fetches fresh data

NEXT TASKS
----------
Per TASK_QUEUE.md, remaining items:
- P2: Additional polish items as needed
- Any new items from user feedback

PREVIOUS SESSION
----------------
Admin Console user search error surfacing fix (completed)
