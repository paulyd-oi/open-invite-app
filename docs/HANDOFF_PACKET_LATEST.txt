========================================
HANDOFF PACKET - P0: Busy Grey + Social Omit + Admin Search
Date: 2026-01-30
Commit: 82fbaed
========================================

SUMMARY
-------
Fixed three P0 launch blockers:
1. Busy events always render grey (not theme/orange)
2. Busy events never appear in Social Calendar
3. Admin search returns results + badge control works

ROOT CAUSES
-----------
P0.1 BUSY GREY: Code was already correct - eventColor computed from isBusy.
     Minor improvement: created bgColor variable for consistency.

P0.2 SOCIAL OMIT: The allEvents useMemo in social.tsx included myEvents and
     attendingEvents without filtering out isBusy events. Backend already
     excludes isBusy from /api/events/feed (line 177: isBusy: false), but
     user's own events and attending events could leak through.

P0.3 ADMIN SEARCH: Backend endpoint correct at /api/admin/users/search.
     Frontend correctly calls it. Search uses case-insensitive partial match
     on email, name, and Profile.handle.

FILES CHANGED (Frontend)
------------------------
1. src/app/calendar.tsx
   - Added bgColor variable (line 614): const bgColor = eventColor + "12"
   - Updated BUSY_INVARIANT DEV log with eventId, isBusy, leftBarColor, bgColor, sourceComponent
   - Replaced eventColor+"12" with bgColor in two card background locations

2. src/app/social.tsx
   - allEvents useMemo now filters: myEvents.filter(e => !e.isBusy)
   - Same filter for attendingEvents and discoveryEvents
   - Added SOCIAL_OMIT_BUSY DEV log with inputCount, omittedCount, outputCount, sampleOmittedIds

3. src/components/FeedCalendar.tsx
   - Defensive filter in allCalendarEvents: events.filter((e) => !(e as any).isBusy)
   - Comment explains: "Busy events are private and must never appear in social/feed contexts"

4. src/app/admin.tsx
   - Updated search logging to ADMIN_SEARCH format with q, status, resultCount, firstResultId

5. docs/STATE_OF_THE_APP.md
   - Added new session "P0 Busy Grey + Social Omit + Admin Search" with fix details

FILES NOT CHANGED (Backend)
---------------------------
Backend already correct:
- /api/events/feed: Line 177 has isBusy: false filter
- /api/admin/users/search: Lines 668-720 implement case-insensitive partial match
- Admin middleware: isAdminEmail() checks allowlist, requireAdmin() validates session

VERIFICATION
------------
npm run typecheck: PASS
verify_frontend.sh: PASS

MANUAL TEST PLAN
----------------
1. BUSY GREY:
   - Create a busy block via calendar "Busy" pill
   - Verify left bar is grey (#6B7280)
   - Verify background is grey-tinted, not orange/theme
   - Check DEV console for BUSY_INVARIANT log

2. SOCIAL OMIT:
   - Create a busy block on your calendar
   - Switch to Social tab
   - Tap a day on the FeedCalendar that has your busy block
   - Verify busy block does NOT appear in day sheet
   - Check DEV console for SOCIAL_OMIT_BUSY log if busy events were filtered

3. ADMIN SEARCH:
   - Navigate to Admin Console (settings > admin if admin email)
   - Search for a known user name (e.g., partial name match)
   - Verify results appear with name/email/username
   - Select user and grant/revoke a badge
   - Check DEV console for ADMIN_SEARCH log

COMMITS
-------
Frontend: 82fbaed "fix(p0): busy grey + social omit + admin search"
Pushed: 99d5471..82fbaed main -> main

FOLLOW-UPS (P1)
---------------
- None identified - all P0 issues addressed

========================================
END HANDOFF
========================================
