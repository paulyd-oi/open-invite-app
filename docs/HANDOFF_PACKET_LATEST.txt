HANDOFF PACKET - Auth Race Fix + Upload Image Public
================================================================================

SUMMARY
-------
1. Fixed authed queries firing during logout/loading (401 spam)
2. Fixed /uploads/ images blocked by legacy bearer token check
3. All authed queries now gated on `bootStatus === 'authed'`

PRECHECK
--------
pwd: /Users/paulsmbp/Documents/GitHub/open-invite-app
branch: main
remote: https://github.com/paulyd-oi/open-invite-app.git
status: clean after push

ROOT CAUSE
----------
1. AUTH RACE: Queries used `enabled: !!session` but cached session persists
   briefly after logout. Queries fired while bootStatus was 'loading'/'loggedOut'
   causing 401 spam.

2. UPLOAD BLOCKING: imageSource.ts treated all backend URLs as protected,
   requiring bearer token. But /uploads/ is PUBLIC on backend (200 without auth).
   Result: avatar images failed to render after logout.

CHANGES
-------
Files changed:
- src/lib/imageSource.ts - /uploads/ paths now treated as public
- src/app/profile.tsx - All queries gated on bootStatus === 'authed'
- src/app/settings.tsx - Added useBootAuthority, gated queries
- src/app/friends.tsx - Friends/groups/circles queries gated
- src/app/calendar.tsx - workSchedule query gated
- docs/STATE_OF_THE_APP.md - Updated
- docs/FINDINGS_LOG.md - Added two new findings

KEY DIFFS
---------
imageSource.ts requiresAuth():
  // /uploads/ paths are PUBLIC - no auth required
  if (trimmed.startsWith("/uploads/") || trimmed.includes("/uploads/")) {
    return false;
  }

All query files:
  BEFORE: enabled: !!session
  AFTER:  enabled: bootStatus === 'authed'

TESTING
-------
Commands run:
- npm run typecheck: PASSED
- scripts/ai/verify_frontend.sh: PASSED

MANUAL TEST PLAN
----------------
A) Fresh install / clear app storage
B) Create brand-new account (email signup)
   - Confirm /api/auth/session returns 200 right after signup
   - Confirm onboarding continues, app lands in authed state
C) Logout
   - Confirm app routes to /login
   - Confirm NO protected endpoint 401 spam (only bootstrap /api/auth/session 401 OK)
D) Login as DIFFERENT user
   - Confirm UI shows correct user, no prior user data
   - Confirm avatar renders without "token required" logs

GIT STATUS
----------
Commit: PENDING
Push: PENDING

VERIFICATION
------------
Manual checks needed:
A) Fresh install / clear app storage
B) Create new account via email signup
   - Confirm logs show refreshExplicitCookie success
   - Confirm /api/auth/session returns 200 immediately after signup
   - Confirm onboarding continues (no bounce to login)
C) Logout then login existing account still works
D) Switch accounts: logout â†’ login different account works

STATE UPDATE
------------
STATE_OF_THE_APP updated: YES
FINDINGS_LOG updated: YES
INVARIANTS changed: NO

GIT
---
Commit: PENDING
Pushed: PENDING
