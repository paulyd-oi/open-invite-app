# HANDOFF: P0 DEV TOOLS LOCKDOWN

## Task Completed
Block dev screens/routes in production builds.

## Changes Made

### New File: src/lib/devToolsGate.tsx
- `isDevToolsEnabled()`: returns `__DEV__ || process.env.EXPO_PUBLIC_DEV_TOOLS === "1"`
- `DevToolsBlockedScreen`: graceful redirect to /settings, minimal fallback UI

### Modified Files

1. **src/app/dev-smoke-tests.tsx** (line 195)
   - Added first-line check: `if (!isDevToolsEnabled()) return <DevToolsBlockedScreen name="dev-smoke-tests" />;`
   - Removed old `module.exports` gate pattern

2. **src/app/admin.tsx** (line 46)
   - Added first-line check: `if (!isDevToolsEnabled()) return <DevToolsBlockedScreen name="admin" />;`

3. **src/app/debug/health.tsx** (line 23)
   - Added first-line check: `if (!isDevToolsEnabled()) return <DevToolsBlockedScreen name="debug/health" />;`
   - Removed old useEffect-based guard

4. **src/lib/nav.ts** (line 102)
   - `goToDevSmokeTests()` now silent no-op if dev tools disabled

5. **src/app/settings.tsx** (lines 84, 1236, 2211)
   - Added import for `isDevToolsEnabled`
   - Admin Console section: `{adminStatus?.isAdmin && isDevToolsEnabled() && ...}`
   - Debug/health longPress: `onLongPress={isDevToolsEnabled() ? () => {...} : undefined}`

## Verification

### Typecheck
```
npm run typecheck  # PASS
```

### Frontend Verification
```
bash scripts/ai/verify_frontend.sh  # PASS
```

### Grep Proofs

#### isDevToolsEnabled usage:
```
src/lib/devToolsGate.tsx:22  export function isDevToolsEnabled()
src/app/debug/health.tsx:9   import { isDevToolsEnabled, DevToolsBlockedScreen }
src/app/debug/health.tsx:23  if (!isDevToolsEnabled()) return <DevToolsBlockedScreen>
src/lib/nav.ts:8             import { isDevToolsEnabled }
src/lib/nav.ts:102           if (!isDevToolsEnabled()) {
src/app/admin.tsx:16         import { isDevToolsEnabled, DevToolsBlockedScreen }
src/app/admin.tsx:46         if (!isDevToolsEnabled()) return <DevToolsBlockedScreen>
src/app/settings.tsx:84      import { isDevToolsEnabled }
src/app/settings.tsx:1236    onLongPress={isDevToolsEnabled() ? () => {
src/app/settings.tsx:2211    {adminStatus?.isAdmin && isDevToolsEnabled() && (
src/app/dev-smoke-tests.tsx:10   import { isDevToolsEnabled, DevToolsBlockedScreen }
src/app/dev-smoke-tests.tsx:195  if (!isDevToolsEnabled()) return <DevToolsBlockedScreen>
```

#### DevToolsBlockedScreen usage:
```
src/lib/devToolsGate.tsx:31  export function DevToolsBlockedScreen()
src/app/debug/health.tsx:23  return <DevToolsBlockedScreen name="debug/health" />
src/app/admin.tsx:46         return <DevToolsBlockedScreen name="admin" />
src/app/dev-smoke-tests.tsx:195  return <DevToolsBlockedScreen name="dev-smoke-tests" />
```

## Production Behavior

In production builds (when `__DEV__` is false):
1. Deep links to `/dev-smoke-tests`, `/admin`, `/debug/health` redirect to `/settings`
2. Admin Console menu item hidden even for admins
3. Long-press on Settings header does nothing
4. `nav.goToDevSmokeTests()` is a silent no-op

To enable dev tools in a production build:
```
EXPO_PUBLIC_DEV_TOOLS=1
```

## Commit
```
a03f259 P0: Block dev screens in production - created devToolsGate.tsx
```

## Status
COMPLETE - Ready for TestFlight
